// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x", "linux-arm64-openssl-1.1.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum FeatureType {
  INTEGER
  FLOAT
  STRING
  BOOLEAN
  JSON

  @@map("feature_type")
}

model Feature {
  id             String     @id @default(cuid())
  tenantId       String     @map("tenant_id")
  key            String
  type           FeatureType
  defaultValue   Json       @map("default_value")
  description    String?
  createdAt      DateTime   @default(now()) @map("created_at")

  @@unique([id, tenantId])
  @@unique([tenantId, key])
  @@index([tenantId])

  @@map("features")
}

model Package {
  id                    String       @id @default(cuid())
  tenantId              String       @map("tenant_id")
  name                  String
  description           String?
  version               String
  parentPackage         Package?     @relation(name: "PackageInheritence", fields: [tenantId, parentPackageName, parentPackageVersion], references: [tenantId, name, version])
  parentPackageName     String?      @map("parent_package_id")
  parentPackageVersion  String?      @map("parent_package_version")
  childPackages         Package[]    @relation(name: "PackageInheritence")
  appliedFeatures       Json         @map("applied_features")
  createdAt             DateTime     @default(now()) @map("created_at")

  @@unique([id, tenantId])
  @@unique([tenantId, name, version(sort: Desc)])
  @@index([tenantId])

  @@map("packages")
}
